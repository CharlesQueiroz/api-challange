{
  "info": {
    "_postman_id": "d6b3f8db-9b77-4f9b-bf76-f3211f4bb1c9",
    "name": "E-Commerce API - Recruiter",
    "description": "Colecao para validar todos os endpoints da API de e-commerce via fluxo CRUD completo. Execute na ordem listada para reaproveitar variaveis automaticas de code/version.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "00 - Health e Docs",
      "item": [
        {
          "name": "GET /actuator/health",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/actuator/health",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "actuator",
                "health"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "01 - Products",
      "item": [
        {
          "name": "GET /api/products",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var body = pm.response.json();",
                  "pm.test('Paged payload has content', function () {",
                  "  pm.expect(body).to.have.property('content');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/products?page=0&size=20&sort=createdAt,desc",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "products"
              ],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "20"
                },
                {
                  "key": "sort",
                  "value": "createdAt,desc"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "POST /api/products (Product A)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "  pm.response.to.have.status(201);",
                  "});",
                  "var body = pm.response.json();",
                  "if (body && body.code) {",
                  "  pm.collectionVariables.set('productACode', body.code);",
                  "  pm.collectionVariables.set('productAVersion', String(body.version));",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Mouse Pro\",\n  \"description\": \"Mouse wireless\",\n  \"price\": {\n    \"amount\": 49.90\n  },\n  \"stockQuantity\": 200\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/products",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "products"
              ]
            }
          },
          "response": []
        },
        {
          "name": "POST /api/products (Product B)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "  pm.response.to.have.status(201);",
                  "});",
                  "var body = pm.response.json();",
                  "if (body && body.code) {",
                  "  pm.collectionVariables.set('productBCode', body.code);",
                  "  pm.collectionVariables.set('productBVersion', String(body.version));",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Keyboard Pro\",\n  \"description\": \"Keyboard mechanical\",\n  \"price\": {\n    \"amount\": 99.90\n  },\n  \"stockQuantity\": 150\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/products",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "products"
              ]
            }
          },
          "response": []
        },
        {
          "name": "POST /api/products (Product Temp Delete)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "  pm.response.to.have.status(201);",
                  "});",
                  "var body = pm.response.json();",
                  "if (body && body.code) {",
                  "  pm.collectionVariables.set('productTempCode', body.code);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Temporary Product\",\n  \"description\": \"Used only for delete endpoint\",\n  \"price\": {\n    \"amount\": 10.00\n  },\n  \"stockQuantity\": 10\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/products",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "products"
              ]
            }
          },
          "response": []
        },
        {
          "name": "GET /api/products/{code} (Product A)",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var productCode = pm.collectionVariables.get('productACode');",
                  "if (!productCode || productCode === 'null') {",
                  "  throw new Error('productACode nao definido. Execute POST /api/products (Product A) antes deste request.');",
                  "}"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var body = pm.response.json();",
                  "pm.collectionVariables.set('productAVersion', String(body.version));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/products/{{productACode}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "products",
                "{{productACode}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "PUT /api/products/{code} (Product A)",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var productCode = pm.collectionVariables.get('productACode');",
                  "if (!productCode || productCode === 'null') {",
                  "  throw new Error('productACode nao definido. Execute POST /api/products (Product A) antes deste request.');",
                  "}"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var body = pm.response.json();",
                  "pm.collectionVariables.set('productAVersion', String(body.version));"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Mouse Pro Updated\",\n  \"description\": \"Mouse updated\",\n  \"price\": {\n    \"amount\": 59.90\n  },\n  \"stockQuantity\": 220,\n  \"version\": {{productAVersion}}\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/products/{{productACode}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "products",
                "{{productACode}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "DELETE /api/products/{code} (Temp)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 204', function () {",
                  "  pm.response.to.have.status(204);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/products/{{productTempCode}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "products",
                "{{productTempCode}}"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "02 - Orders e OrderItems",
      "item": [
        {
          "name": "POST /api/orders (Order 1)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "  pm.response.to.have.status(201);",
                  "});",
                  "var body = pm.response.json();",
                  "pm.collectionVariables.set('order1Code', body.code);",
                  "pm.collectionVariables.set('order1Version', String(body.version));",
                  "pm.collectionVariables.set('order1CustomerName', body.customerName);",
                  "pm.collectionVariables.set('order1CustomerEmail', body.customerEmail);",
                  "if (body.items && body.items.length > 0) {",
                  "  pm.collectionVariables.set('orderItemFromOrderCode', body.items[0].code);",
                  "  pm.collectionVariables.set('orderItemFromOrderVersion', String(body.items[0].version));",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"customerName\": \"Recruiter Test\",\n  \"customerEmail\": \"recruiter@test.com\",\n  \"items\": [\n    {\n      \"productCode\": \"{{productACode}}\",\n      \"quantity\": 2\n    },\n    {\n      \"productCode\": \"{{productBCode}}\",\n      \"quantity\": 1\n    }\n  ]\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/orders",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "orders"
              ]
            }
          },
          "response": []
        },
        {
          "name": "GET /api/orders/{code} (Order 1)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var body = pm.response.json();",
                  "pm.collectionVariables.set('order1Version', String(body.version));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/orders/{{order1Code}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "orders",
                "{{order1Code}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "GET /api/orders/{code}/order-items",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var body = pm.response.json();",
                  "pm.test('Paged payload has content', function () {",
                  "  pm.expect(body).to.have.property('content');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/orders/{{order1Code}}/order-items?page=0&size=20&sort=createdAt,desc",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "orders",
                "{{order1Code}}",
                "order-items"
              ],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "20"
                },
                {
                  "key": "sort",
                  "value": "createdAt,desc"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "GET /api/order-items",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var body = pm.response.json();",
                  "pm.test('Paged payload has content', function () {",
                  "  pm.expect(body).to.have.property('content');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/order-items?page=0&size=20&sort=createdAt,desc",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "order-items"
              ],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "20"
                },
                {
                  "key": "sort",
                  "value": "createdAt,desc"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "POST /api/order-items (Extra)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "  pm.response.to.have.status(201);",
                  "});",
                  "var body = pm.response.json();",
                  "pm.collectionVariables.set('orderItemExtraCode', body.code);",
                  "pm.collectionVariables.set('orderItemExtraVersion', String(body.version));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"productCode\": \"{{productBCode}}\",\n  \"quantity\": 1,\n  \"orderCode\": \"{{order1Code}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/order-items",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "order-items"
              ]
            }
          },
          "response": []
        },
        {
          "name": "GET /api/order-items/{code} (Extra)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var body = pm.response.json();",
                  "pm.collectionVariables.set('orderItemExtraVersion', String(body.version));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/order-items/{{orderItemExtraCode}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "order-items",
                "{{orderItemExtraCode}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "PUT /api/order-items/{code} (Extra)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var body = pm.response.json();",
                  "pm.collectionVariables.set('orderItemExtraVersion', String(body.version));"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"quantity\": 2,\n  \"version\": {{orderItemExtraVersion}}\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/order-items/{{orderItemExtraCode}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "order-items",
                "{{orderItemExtraCode}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "DELETE /api/order-items/{code} (Extra)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 204', function () {",
                  "  pm.response.to.have.status(204);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/order-items/{{orderItemExtraCode}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "order-items",
                "{{orderItemExtraCode}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "GET /api/orders/{code} (refresh version)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var body = pm.response.json();",
                  "pm.collectionVariables.set('order1Version', String(body.version));",
                  "pm.collectionVariables.set('order1CustomerName', body.customerName);",
                  "pm.collectionVariables.set('order1CustomerEmail', body.customerEmail);"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/orders/{{order1Code}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "orders",
                "{{order1Code}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "PUT /api/orders/{code} (Order 1 -> PROCESSING)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var body = pm.response.json();",
                  "pm.collectionVariables.set('order1Version', String(body.version));"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"customerName\": \"{{order1CustomerName}}\",\n  \"customerEmail\": \"{{order1CustomerEmail}}\",\n  \"status\": \"PROCESSING\",\n  \"version\": {{order1Version}}\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/orders/{{order1Code}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "orders",
                "{{order1Code}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "GET /api/orders",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var body = pm.response.json();",
                  "pm.test('Paged payload has content', function () {",
                  "  pm.expect(body).to.have.property('content');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/orders?page=0&size=20&sort=createdAt,desc",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "orders"
              ],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "20"
                },
                {
                  "key": "sort",
                  "value": "createdAt,desc"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "POST /api/orders (Order Temp Delete)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "  pm.response.to.have.status(201);",
                  "});",
                  "var body = pm.response.json();",
                  "pm.collectionVariables.set('orderTempCode', body.code);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"customerName\": \"Order Delete Candidate\",\n  \"customerEmail\": \"delete-order@test.com\",\n  \"items\": [\n    {\n      \"productCode\": \"{{productBCode}}\",\n      \"quantity\": 1\n    }\n  ]\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/orders",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "orders"
              ]
            }
          },
          "response": []
        },
        {
          "name": "DELETE /api/orders/{code} (Temp)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 204', function () {",
                  "  pm.response.to.have.status(204);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/orders/{{orderTempCode}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "orders",
                "{{orderTempCode}}"
              ]
            }
          },
          "response": []
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080"
    },
    {
      "key": "productACode",
      "value": ""
    },
    {
      "key": "productAVersion",
      "value": "0"
    },
    {
      "key": "productBCode",
      "value": ""
    },
    {
      "key": "productBVersion",
      "value": "0"
    },
    {
      "key": "productTempCode",
      "value": ""
    },
    {
      "key": "order1Code",
      "value": ""
    },
    {
      "key": "order1Version",
      "value": "0"
    },
    {
      "key": "order1CustomerName",
      "value": "Recruiter Test"
    },
    {
      "key": "order1CustomerEmail",
      "value": "recruiter@test.com"
    },
    {
      "key": "orderItemFromOrderCode",
      "value": ""
    },
    {
      "key": "orderItemFromOrderVersion",
      "value": "0"
    },
    {
      "key": "orderItemExtraCode",
      "value": ""
    },
    {
      "key": "orderItemExtraVersion",
      "value": "0"
    },
    {
      "key": "orderTempCode",
      "value": ""
    }
  ]
}
